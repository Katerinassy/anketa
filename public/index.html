<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Анкета для студентов-практикантов</title>
    <link href="styles.css" rel="stylesheet">
</head>

<body>
    <div class="container">
        <div class="photo-placeholder">
            <div class="placeholder-text">Место для фотографии</div>
            <label for="photoUpload" class="photo-label">Загрузить</label>
            <input type="file" id="photoUpload" name="photo" accept="image/*">
            <img id="photoPreview" class="photo-preview" alt="Фото студента">
        </div>

        <h1>Анкета для студентов-практикантов</h1>

        <form id="internForm" enctype="multipart/form-data">
            <div class="form-group">
                <label for="fullName">Ф.И.О.</label>
                <input type="text" id="fullName" name="fullName" required>
            </div>

            <div class="form-group">
                <label for="phone">Контактный телефон</label>
                <input type="tel" id="phone" name="phone" required>
            </div>

            <div class="form-group">
                <label for="birthDate">Дата рождения</label>
                <input type="date" id="birthDate" name="birthDate" required>
            </div>

            <div class="form-group">
                <label for="age">Сколько Вам полных лет?</label>
                <input type="number" id="age" name="age" min="16" max="99" required>
            </div>

            <div class="form-group">
                <label for="citizenship">Гражданство</label>
                <input type="text" id="citizenship" name="citizenship" required>
            </div>

            <div class="form-group">
                <label for="address">Адрес проживания, ближайшее метро</label>
                <input type="text" id="address" name="address" required>
            </div>

            <div class="section">
                <h3 class="section-title">Образование</h3>

                <div class="form-group">
                    <label for="institution">Наименование учебного заведения</label>
                    <input type="text" id="institution" name="institution" required>
                </div>

                <div class="form-group">
                    <label for="specialty">Специальность</label>
                    <input type="text" id="specialty" name="specialty" required>
                </div>

                <div class="form-group">
                    <label for="course">Курс</label>
                    <input type="number" id="course" name="course" min="1" max="6" required>
                </div>

                <div class="form-group">
                    <label for="studyForm">Форма обучения</label>
                    <select id="studyForm" name="studyForm" required>
                        <option value="">Выберите форму обучения</option>
                        <option value="full-time">Очная</option>
                        <option value="part-time">Очно-заочная</option>
                        <option value="extramural">Заочная</option>
                        <option value="distance">Дистанционная</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="gpa">Средний балл</label>
                    <input type="number" id="gpa" name="gpa" step="0.1" min="1" max="5" required>
                </div>

                <div class="form-group">
                    <label for="studyInterest">Вам интересно учиться?</label>
                    <textarea id="studyInterest" name="studyInterest" required></textarea>
                </div>
            </div>

            <div class="section">
                <h3 class="section-title">Информация о практике</h3>

                <div class="form-group">
                    <label for="howKnow">Как вы узнали о нас?</label>
                    <input type="text" id="howKnow" name="howKnow" required>
                </div>

                <div class="form-group">
                    <label for="practiceBenefits">Какие преимущества Вы видите в стажировке у нас?</label>
                    <textarea id="practiceBenefits" name="practiceBenefits" required></textarea>
                </div>

                <div class="form-group">
                    <label for="previousPractice">Проходили ли вы практику ранее?</label>
                    <textarea id="previousPractice" name="previousPractice" required></textarea>
                </div>

                <div class="form-group">
                    <label for="internetResearch">Вы работали с поиском информации в интернете?</label>
                    <textarea id="internetResearch" name="internetResearch" required></textarea>
                </div>

                <div class="form-group">
                    <label for="clientOrders">Вы рассчитывали когда-нибудь заказы клиентов?</label>
                    <textarea id="clientOrders" name="clientOrders" required></textarea>
                </div>

                <div class="form-group">
                    <label for="teamwork">Любите ли Вы работать в команде?</label>
                    <select id="teamwork" name="teamwork" required>
                        <option value="">Выберите ответ</option>
                        <option value="yes">Да</option>
                        <option value="no">Нет</option>
                        <option value="sometimes">Иногда</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="practiceExpectations">Что Вы хотите получить от практики?</label>
                    <textarea id="practiceExpectations" name="practiceExpectations" required></textarea>
                </div>

                <div class="form-group">
                    <label for="supplierMonitoring">Проводили ли Вы мониторинг поставщиков в интернете?</label>
                    <select id="supplierMonitoring" name="supplierMonitoring" required>
                        <option value="">Выберите ответ</option>
                        <option value="yes">Да</option>
                        <option value="no">Нет</option>
                    </select>
                </div>
            </div>

            <div class="section">
                <h3 class="section-title">Навыки и умения</h3>

                <div class="form-group">
                    <label>Какими программами Вы владеете:</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="powerPoint" name="skills" value="PowerPoint">
                            <label for="powerPoint">PowerPoint</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="outlook" name="skills" value="Outlook">
                            <label for="outlook">Outlook</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="excel" name="skills" value="Excel">
                            <label for="excel">Excel</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="word" name="skills" value="Word">
                            <label for="word">Word</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="1c" name="skills" value="1С">
                            <label for="1c">1С</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="illustrator" name="skills" value="Illustrator">
                            <label for="illustrator">Illustrator</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="photoshop" name="skills" value="Photoshop">
                            <label for="photoshop">Photoshop</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="corel" name="skills" value="Corel Draw">
                            <label for="corel">Corel Draw</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="practiceActivities">Чем бы Вы хотели заниматься на практике?</label>
                    <textarea id="practiceActivities" name="practiceActivities" required></textarea>
                </div>

                <div class="form-group">
                    <label for="hobbies">Есть ли у Вас хобби?</label>
                    <textarea id="hobbies" name="hobbies" required></textarea>
                </div>

                <div class="form-group">
                    <label for="practicalExperience">Каким практическим опытом Вы обладаете?</label>
                    <textarea id="practicalExperience" name="practicalExperience" required></textarea>
                </div>

                <div class="form-group">
                    <label for="professionalTasks">Какие профессиональные задачи Вы способны решать наиболее
                        компетентно?</label>
                    <textarea id="professionalTasks" name="professionalTasks" required></textarea>
                </div>

                <div class="form-group">
                    <label for="socialMedia">Как Вы относитесь к социальным сетям, сколько времени проводите в
                        них?</label>
                    <textarea id="socialMedia" name="socialMedia" required></textarea>
                </div>

                <div class="form-group">
                    <label for="futureVision">Кем Вы себя видите через год?</label>
                    <textarea id="futureVision" name="futureVision" required></textarea>
                </div>

                <div class="form-group">
                    <label for="exhibitions">Принимали ли Вы участия в выставках? В качестве кого?</label>
                    <textarea id="exhibitions" name="exhibitions" required></textarea>
                </div>

                <div class="form-group">
                    <label for="adDesign">Вы когда-нибудь подготавливали рекламные макеты к производству?</label>
                    <textarea id="adDesign" name="adDesign" required></textarea>
                </div>

                <div class="form-group">
                    <label for="printMaterials">Занимались ли Вы оформлением полиграфических материалов в виде буклетов,
                        брошюр, плакатов, наружной рекламы и прочего?</label>
                    <select id="printMaterials" name="printMaterials" required>
                        <option value="">Выберите ответ</option>
                        <option value="yes">Да</option>
                        <option value="no">Нет</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="creativeConcepts">Вы когда-нибудь занимались разработкой креативных концепций,
                        фирменного стиля?</label>
                    <textarea id="creativeConcepts" name="creativeConcepts" required></textarea>
                </div>

                <div class="form-group">
                    <label for="3dExperience">Работали ли Вы с 3D пакетом?</label>
                    <textarea id="3dExperience" name="3dExperience" required></textarea>
                </div>

                <div class="form-group">
                    <label for="printPrep">Владеете ли Вы техникой на уровне печатной подготовки и цветоделения?</label>
                    <textarea id="printPrep" name="printPrep" required></textarea>
                </div>

                <div class="form-group">
                    <label for="multitasking">Умеете ли Вы работать над несколькими проектами одновременно?</label>
                    <select id="multitasking" name="multitasking" required>
                        <option value="">Выберите ответ</option>
                        <option value="yes">Да</option>
                        <option value="no">Нет</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="emailCampaigns">Делали ли Вы email рассылки?</label>
                    <select id="emailCampaigns" name="emailCampaigns" required>
                        <option value="">Выберите ответ</option>
                        <option value="yes">Да</option>
                        <option value="no">Нет</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="coldCalling">Занимались ли Вы когда-либо обзвоном клиентов?</label>
                    <select id="coldCalling" name="coldCalling" required>
                        <option value="">Выберите ответ</option>
                        <option value="yes">Да</option>
                        <option value="no">Нет</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="contractExperience">Есть ли у Вас опыт в оформлении договора?</label>
                    <textarea id="contractExperience" name="contractExperience" required></textarea>
                </div>

                <div class="form-group">
                    <label for="excelSkills">Насколько хорошо Вы работаете с Excel?</label>
                    <select id="excelSkills" name="excelSkills" required>
                        <option value="">Выберите уровень</option>
                        <option value="basic">Базовый</option>
                        <option value="intermediate">Средний</option>
                        <option value="advanced">Продвинутый</option>
                        <option value="expert">Эксперт</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="printerSkills">Умеете ли Вы пользоваться принтером?</label>
                    <textarea id="printerSkills" name="printerSkills" required></textarea>
                </div>

                <div class="form-group">
                    <label for="souvenirs">Вы работали когда-нибудь с сувенирной продукцией?</label>
                    <textarea id="souvenirs" name="souvenirs" required></textarea>
                </div>

                <div class="form-group">
                    <label for="writingExperience">Есть ли у Вас опыт написания текстов?</label>
                    <textarea id="writingExperience" name="writingExperience" required></textarea>
                </div>

                <div class="form-group">
                    <label for="editingSkills">Умеете ли Вы корректировать текст?</label>
                    <select id="editingSkills" name="editingSkills" required>
                        <option value="">Выберите ответ</option>
                        <option value="yes">Да</option>
                        <option value="no">Нет</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="logoDesign">Вы когда-нибудь создавали логотип?</label>
                    <textarea id="logoDesign" name="logoDesign" required></textarea>
                </div>

                <div class="form-group">
                    <label for="magazineCovers">Делали ли Вы когда-либо обложки журналов?</label>
                    <textarea id="magazineCovers" name="magazineCovers" required></textarea>
                </div>

                <div class="form-group">
                    <label for="businessCards">Вы когда-нибудь изготавливали визитки для предприятия?</label>
                    <select id="businessCards" name="businessCards" required>
                        <option value="">Выберите ответ</option>
                        <option value="yes">Да</option>
                        <option value="no">Нет</option>
                    </select>
                </div>
            </div>

            <div class="section">
                <h3 class="section-title">Опыт работы</h3>

                <div class="form-group">
                    <label for="workExperience">Работали ли Вы ранее?</label>
                    <select id="workExperience" name="workExperience" required>
                        <option value="">Выберите ответ</option>
                        <option value="yes">Да</option>
                        <option value="no">Нет</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="previousJobs">Если да, то где и кем работали?</label>
                    <textarea id="previousJobs" name="previousJobs"></textarea>
                </div>

                <div class="form-group">
                    <label for="likesToDo">Чем Вам нравится заниматься?</label>
                    <textarea id="likesToDo" name="likesToDo" required></textarea>
                </div>

                <div class="form-group">
                    <label for="interestedInJob">Заинтересованы ли Вы в работе после окончания практики?</label>
                    <select id="interestedInJob" name="interestedInJob" required>
                        <option value="">Выберите ответ</option>
                        <option value="yes">Да</option>
                        <option value="no">Нет</option>
                        <option value="maybe">Возможно</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="internshipPeriod">Укажите период стажировки</label>
                    <input type="text" id="internshipPeriod" name="internshipPeriod" required>
                </div>
            </div>

            <div class="section">
                <h3 class="section-title">Заключение</h3>

                <div class="form-group">
                    <label for="submissionDate">Дата</label>
                    <input type="date" id="submissionDate" name="submissionDate" required>
                </div>

                <div class="form-group">
                    <label for="signature">Подпись</label>
                    <input type="text" id="signature" name="signature" required>
                </div>

                <div class="form-group">
                    <label for="interviewer">Кто проводил собеседование</label>
                    <input type="text" id="interviewer" name="interviewer" required>
                </div>
            </div>

            <div class="buttons">
                <button type="submit">Отправить анкету</button>
                <button type="button" id="savePdf">Сохранить PDF</button>
            </div>
        </form>
    </div>

    <!-- Библиотеки -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        // Проверка загрузки библиотек
        console.log('jsPDF:', typeof window.jspdf !== 'undefined');
        console.log('html2canvas:', typeof html2canvas !== 'undefined');

        // Обработка загрузки фото
        document.getElementById('photoUpload').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (file) {
                if (file.size > 2 * 1024 * 1024) {
                    alert('Фото должно быть меньше 2MB');
                    return;
                }
                const reader = new FileReader();
                reader.onload = function (event) {
                    const preview = document.getElementById('photoPreview');
                    const label = document.querySelector('.photo-label');
                    preview.src = event.target.result;
                    preview.style.display = 'block';
                    label.style.display = 'none'; // Скрываем текст "Загрузить"
                    document.querySelector('.placeholder-text').style.display = 'none';
                    console.log('Изображение загружено, src:', preview.src);
                };
                reader.readAsDataURL(file);
            }
        });

        // Обработка отправки формы
        document.getElementById('internForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            console.log('Форма отправляется...');
            const form = this;
            const formData = new FormData(form);
            const submitButton = form.querySelector('button[type="submit"]');
            submitButton.textContent = 'Отправка...';
            submitButton.disabled = true;

            try {
                console.log('Отправка запроса на http://localhost:3000/api/application...');
                const response = await fetch('http://localhost:3000/api/application', {
                    method: 'POST',
                    body: formData
                });

                console.log('Ответ получен, статус:', response.status);
                const result = await response.json();
                console.log('Ответ сервера:', result);

                if (response.ok) {
                    alert('Анкета успешно отправлена! ID: ' + result.applicationId);
                    form.reset();
                    const photoPreview = document.getElementById('photoPreview');
                    photoPreview.src = '';
                    photoPreview.style.display = 'none';
                    document.querySelector('.photo-label').style.display = 'block';
                    document.querySelector('.placeholder-text').style.display = 'block';
                } else {
                    alert('Ошибка при отправке анкеты: ' + (result.error || 'Неизвестная ошибка, статус: ' + response.status));
                }
            } catch (error) {
                console.error('Ошибка при отправке:', error);
                alert('Произошла ошибка при отправке анкеты. Пожалуйста, проверьте соединение с сервером или консоль для деталей.');
            } finally {
                submitButton.textContent = 'Отправить анкету';
                submitButton.disabled = false;
            }
        });

        // Инициализация jsPDF
        const { jsPDF } = window.jspdf;

        document.getElementById('savePdf').addEventListener('click', async function () {
            console.log('Начало генерации PDF...');
            const btn = this;
            const originalText = btn.textContent;
            btn.textContent = 'Генерация PDF...';
            btn.disabled = true;

            try {
                const element = document.querySelector('.container');
                if (!element) {
                    console.error('Элемент .container не найден');
                    throw new Error('Элемент .container не найден');
                }
                console.log('Элемент .container найден, высота:', element.scrollHeight);

                const photoPreview = document.getElementById('photoPreview');
                console.log('Photo Preview src:', photoPreview ? photoPreview.src : 'Не найден');
                console.log('Photo Preview display:', photoPreview ? photoPreview.style.display : 'Не найден');

                if (photoPreview && photoPreview.src && photoPreview.style.display !== 'none') {
                    await new Promise(resolve => {
                        photoPreview.onload = resolve;
                        if (photoPreview.complete && photoPreview.naturalWidth > 0) {
                            console.log('Изображение готово, naturalWidth:', photoPreview.naturalWidth);
                            resolve();
                        } else {
                            console.log('Перезапуск загрузки изображения...');
                            photoPreview.src = photoPreview.src;
                        }
                    });
                }

                const options = {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    logging: true,
                    windowWidth: element.scrollWidth,
                    windowHeight: element.scrollHeight,
                    backgroundColor: '#ffffff'
                };

                console.log('Запуск html2canvas...');
                const canvas = await html2canvas(element, options);
                console.log('html2canvas завершен, canvas высота:', canvas.height);

                const imgData = canvas.toDataURL('image/png', 1.0);
                const pdf = new jsPDF('p', 'pt', 'a4');
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const margin = 20;
                const imgWidth = pageWidth - 2 * margin;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;

                let heightLeft = imgHeight;
                let position = margin;

                while (heightLeft >= 0) {
                    pdf.addImage(imgData, 'PNG', margin, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight - 2 * margin;
                    position -= (pageHeight - 2 * margin);
                    if (heightLeft > 0) {
                        pdf.addPage();
                    }
                }

                console.log('Сохранение PDF...');
                pdf.save('Анкета_стажера.pdf');
            } catch (error) {
                console.error('Ошибка при генерации PDF:', error);
                alert('Произошла ошибка при создании PDF. Проверьте консоль браузера для деталей.');
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
            }
        });

        // Автоматический расчет возраста
        const birthDateInput = document.getElementById('birthDate');
        const ageInput = document.getElementById('age');
        if (birthDateInput && ageInput) {
            birthDateInput.addEventListener('change', function () {
                const birthDate = new Date(this.value);
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();

                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }

                ageInput.value = age >= 0 ? age : '';
            });
        }
    </script>
</body>

</html>